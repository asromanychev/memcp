# Тестирование MCP-сервера через Cursor IDE

## Проверка работы API

Перед тестированием через Cursor IDE убедитесь, что Rails API работает:

```bash
# Проверка health check
curl http://localhost:3001/up

# Тест recall
curl -X POST http://localhost:3001/recall \
  -H "Content-Type: application/json" \
  -d '{"query":"test query","project_path":"/home/aromanychev/dev/mcp/memcp"}'

# Тест save
curl -X POST http://localhost:3001/save \
  -H "Content-Type: application/json" \
  -d '{"content":"test content","project_path":"/home/aromanychev/dev/mcp/memcp","metadata":{}}'
```

## Тестирование через чат в Cursor IDE

### 1. Тест инструмента `save` (сохранение памяти)

**В чате Cursor IDE напишите:**

```
Сохрани память: "В проекте используется Rails 8.0.2 и PostgreSQL с pgvector для векторных поисков"
```

**Или более явно:**

```
Используй инструмент save чтобы сохранить: "В проекте memcp используется Ruby on Rails API-only для Core API и Ruby MCP-сервер для интеграции с IDE"
```

**Ожидаемый результат:**
- Агент должен вызвать инструмент `save`
- Вы должны увидеть ответ от API с статусом `success`
- В ответе будет сообщение "Save method called (stub)"

### 2. Тест инструмента `recall` (поиск памяти)

**В чате Cursor IDE напишите:**

```
Найди воспоминания о Rails API
```

**Или:**

```
Используй recall чтобы найти информацию о проекте
```

**Ожидаемый результат:**
- Агент должен вызвать инструмент `recall`
- Вы должны увидеть ответ от API с результатами поиска
- В ответе будет сообщение "Recall method called (stub)" и пустой массив результатов (так как это заглушка)

### 3. Комбинированный тест

**В чате Cursor IDE напишите:**

```
Сохрани информацию о том, что проект использует порт 3001 для Rails API, а затем найди все воспоминания о конфигурации портов
```

**Ожидаемый результат:**
- Сначала должен быть вызван `save`
- Затем должен быть вызван `recall`
- Оба должны вернуть успешные ответы

## Примеры запросов для тестирования

### Сохранение памяти:

1. **Простой запрос:**
   ```
   Сохрани: "MCP сервер работает на порту 3001"
   ```

2. **С метаданными:**
   ```
   Сохрани память с метаданными: проект использует pgvector версии 0.5.1
   ```

3. **Техническая информация:**
   ```
   Запомни: "В проекте используется PostgreSQL 14 с расширением vector для векторных embeddings размерностью 1536"
   ```

### Поиск памяти:

1. **Простой поиск:**
   ```
   Найди информацию о Rails
   ```

2. **Поиск по проекту:**
   ```
   Найди все воспоминания о конфигурации базы данных
   ```

3. **Уточняющий поиск:**
   ```
   Вспомни что мы обсуждали про MCP сервер
   ```

## Что проверить в логах

Если что-то не работает, проверьте:

1. **Логи Cursor IDE** - должны быть сообщения о вызовах инструментов
2. **Логи Rails API** - должны быть HTTP запросы к `/recall` и `/save`
3. **Логи MCP-сервера** - если запущен отдельно, должны быть JSON-RPC запросы

## Отладка

### Если инструменты не вызываются:

1. Проверьте, что MCP-сервер подключен в настройках Cursor IDE
2. Перезапустите Cursor IDE
3. Проверьте логи Cursor IDE на наличие ошибок

### Если API возвращает ошибки:

1. Убедитесь, что Rails сервер запущен на порту 3001:
   ```bash
   curl http://localhost:3001/up
   ```

2. Проверьте логи Rails сервера:
   ```bash
   tail -f log/development.log
   ```

3. Проверьте, что MCP-сервер использует правильный URL:
   - По умолчанию: `http://localhost:3001`
   - Или переменная окружения `MEMCP_API_URL`

### Если инструменты вызываются, но не работают:

1. Проверьте формат ответа от MCP-сервера
2. Проверьте формат запросов к Rails API
3. Убедитесь, что все JSON валиден

## Ожидаемое поведение для MVP

Так как это MVP Итерация 1 с заглушками:

- **`save`** - всегда возвращает `{"status": "success", "message": "Save method called (stub)", ...}`
- **`recall`** - всегда возвращает `{"status": "success", "message": "Recall method called (stub)", "results": []}`

Реальная логика сохранения и поиска будет реализована в следующих итерациях.

## Следующие шаги после тестирования

После успешного тестирования можно:
1. Реализовать реальную логику сохранения с генерацией embeddings
2. Реализовать векторный поиск для recall
3. Добавить обработку ошибок
4. Добавить логирование

