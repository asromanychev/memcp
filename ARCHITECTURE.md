# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ MemCP

> üìã **–ò—Å—Ö–æ–¥–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ –¥–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ** –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø—Ä–æ–µ–∫—Ç–µ `insales_atlas/memcp/plan/architecture_overview.md`.  
> –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∫—Ä–∞—Ç–∫—É—é –≤—ã–∂–∏–º–∫—É —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ `memcp`.

## –û–±–∑–æ—Ä

MemCP —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ –≥–∏–±—Ä–∏–¥–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π –ø–∞–º—è—Ç–∏ –∏ file-first –∞–≥–µ–Ω—Ç–∞. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —á–µ—Ç—ã—Ä—ë—Ö —É—Ä–æ–≤–Ω–µ–π:

1. **Resource Adapters** ‚Äì —Ç–æ—á–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º –∏ –≤–Ω–µ—à–Ω–∏–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º
2. **Core Platform Services** ‚Äì –±–∞–∑–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã –ø–∞–º—è—Ç–∏, embeddings –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç–∏
3. **Extension Hub** ‚Äì —Å–ª–æ–π –ø–ª–∞–≥–∏–Ω–æ–≤, –Ω–∞–≤—ã–∫–æ–≤ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∞–≥–µ–Ω—Ç–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
4. **Delivery Interfaces** ‚Äì API, MCP –∏ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è IDE/CLI

## –°–ª–æ–∏ –∏ –º–æ–¥—É–ª–∏

### 1. Resource Adapters

- **Storage Adapter** ‚Äì Postgres + pgvector, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ `MemoryRecord`, –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –∏–Ω–¥–µ–∫—Å—ã
- **File Sync Adapter** ‚úÖ ‚Äì `FileSync::WatcherService`: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ `storage/documents`, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `listen` gem
- **Atlas Adapter** ‚úÖ ‚Äì `Atlas::SyncService`: –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ insales_atlas –≤ `storage/atlas`, —É—á—ë—Ç –¥–µ–¥—É–±–ª–∏–∫–∞—Ü–∏–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- **Embedding Provider Adapter** ‚úÖ ‚Äì Qwen3 –ª–æ–∫–∞–ª—å–Ω–æ (0.6B, 1024d), OpenAI (1536d), –æ–±—â–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç (dimension, endpoint, auth)

### 2. Core Platform Services

- **Memory Service** ‚úÖ ‚Äì `Memories::SaveService`, `Memories::RecallService`, TTL, —Ñ–∏–ª—å—Ç—Ä—ã, –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π + —Ç–µ–∫—Å—Ç–æ–≤—ã–π)
- **Embedding Pipeline** ‚úÖ ‚Äì `Memories::EmbeddingService`, Solid Queue `Memories::GenerateEmbeddingJob`, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- **Observability Hub** ‚úÖ ‚Äì `Observability::HubService`, `Adapters::JsonlWriter` —Å —Ä–æ—Ç–∞—Ü–∏–µ–π –ø–æ 10–ú–ë, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ JSONL-–ª–æ–≥–∏ —Å `trace_id`/`event_id`, duration –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏ error-–∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∏ –Ω–∞–≤—ã–∫–æ–≤

### 3. Extension Hub

- **Agent Skill Registry** ‚úÖ ‚Äì `Skills::Registry`: –æ–ø–∏—Å–∞–Ω–∏—è –Ω–∞–≤—ã–∫–æ–≤, –∫–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–∞ –∞—Ä–≥—É–º–µ–Ω—Ç—ã/–æ—Ç–≤–µ—Ç—ã
- **Planner/Orchestrator Service** ‚úÖ ‚Äì `Planner::SimplePlanner`: –¥–≤—É—Ö—Ñ–∞–∑–Ω—ã–π ReAct (–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí —à–∞–≥–∏ ‚Üí –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫), –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–∏ file-search
- **Skills** ‚úÖ:
  - `Skills::AtlasSearch` ‚Äì –ø–æ–∏—Å–∫ –≤ –∑–µ—Ä–∫–∞–ª–µ `storage/atlas/index.json`
  - `Skills::DocumentsGrep` ‚Äì —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –≤ `storage/documents/`

### 4. Delivery Interfaces

- **REST API** ‚úÖ ‚Äì `MemoryController` —Å —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏ `POST /save`, `POST /recall`
- **MCP Server** ‚úÖ ‚Äì Ruby STDIO —Å–µ—Ä–≤–µ—Ä (`mcp_server.rb`) —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ `recall` –∏ `save`

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (2025-11-11)

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

- **MVP-01: Core API Service Objects**
  - `Memories::RecallService` ‚Äì –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π —á–µ—Ä–µ–∑ pgvector + —Ç–µ–∫—Å—Ç–æ–≤—ã–π —á–µ—Ä–µ–∑ ILIKE)
  - `Memories::SaveService` ‚Äì —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π embeddings —á–µ—Ä–µ–∑ —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

- **MVP-02: –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫**
  - `Memories::EmbeddingService` ‚Äì –≥–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings (–ª–æ–∫–∞–ª—å–Ω—ã–π Qwen3-0.6B –∏–ª–∏ OpenAI)
  - `Memories::GenerateEmbeddingJob` ‚Äì —Ñ–æ–Ω–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Solid Queue
  - Rake task `memories:generate_embeddings` –¥–ª—è –±—ç–∫—Ñ–∏–ª–ª–∞

- **File-first –∞–¥–∞–ø—Ç–µ—Ä—ã**
  - `Atlas::SyncService` ‚Äì –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ insales_atlas —Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π –ø–æ SHA256
  - `FileSync::WatcherService` ‚Äì —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π

- **Skills & Planner MVP**
  - `Skills::Registry` ‚Äì —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫ –Ω–∞–≤—ã–∫–æ–≤
  - `Planner::SimplePlanner` ‚Äì –≤—ã–±–æ—Ä –Ω–∞–≤—ã–∫–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É –∏–ª–∏ —è–≤–Ω–æ–º—É `skill_id`
  - –ù–∞–≤—ã–∫–∏: `atlas_search`, `documents_grep`

- **Observability Hub (–±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)**
  - `Observability::HubService` ‚Äì –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–ø–∏—Å—å —Å–æ–±—ã—Ç–∏–π
  - `Adapters::JsonlWriter` ‚Äì —Ä–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ –ø–æ 10–ú–ë —Å gzip-–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ–º
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `Planner::SimplePlanner` (–æ–ø–µ—Ä–∞—Ü–∏–∏: `planner.start`, `planner.skill_selected`, `skill.execution`, `planner.finish`)

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

**–≠—Ç–∞–ø 2 (—Ç–µ–∫—É—â–∏–π):**
- MVP-03: –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è (SimHash/MinHash –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ø–æ—Ö–æ–∂–∏—Ö –∑–∞–ø–∏—Å–µ–π –∏ upsert –ª–æ–≥–∏–∫–∞)

**–≠—Ç–∞–ø 3 (–æ—Ç–ª–æ–∂–µ–Ω–æ):**
- –†–∞—Å—à–∏—Ä–∏—Ç—å Observability Hub: –∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ –Ω–∞–≤—ã–∫–∞–º, —ç–∫—Å–ø–æ—Ä—Ç –≤ Prometheus/ClickHouse, –∞–ª–µ—Ä—Ç—ã
  - **–ö–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:** –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ (–¥–µ—Å—è—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω), –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ production, —Ä–æ—Å—Ç–µ –∫–æ–º–∞–Ω–¥—ã (–Ω—É–∂–Ω—ã –¥–∞—à–±–æ—Ä–¥—ã), –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –ø—Ä–æ–±–ª–µ–º
- Demo Playbooks (resettable —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è dev-–ø—Ä–∞–∫—Ç–∏–∫)

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Observability Hub

–°–æ–±—ã—Ç–∏—è –ø–∏—à—É—Ç—Å—è –≤ `storage/logs/observability/current.jsonl` –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSONL. –ö–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç:
- `trace_id` (UUID) ‚Äì –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
- `event_id` (UUID) ‚Äì —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–±—ã—Ç–∏—è
- `parent_id` (UUID, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äì –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —à–∞–≥–æ–≤
- `timestamp` (ISO8601)
- `operation` (—Å—Ç—Ä–æ–∫–∞) ‚Äì —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ (`planner.start`, `skill.execution`, –∏ —Ç.–¥.)
- `entity` (—Å—Ç—Ä–æ–∫–∞, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äì –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–∞–≤—ã–∫–∞/–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
- `status` (`success` | `error` | `unknown`)
- `duration_ms` (float, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äì –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
- `payload` (hash, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äì –≤—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- `extra` (hash, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äì –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `result_preview`)
- `error` (hash, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äì –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ (class, message, backtrace)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ storage

- `storage/atlas/` ‚Äì –∑–µ—Ä–∫–∞–ª–æ insales_atlas (blobs + index.json)
- `storage/documents/` ‚Äì –∑–µ—Ä–∫–∞–ª–æ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (blobs + index.json)
- `storage/logs/observability/` ‚Äì JSONL-–ª–æ–≥–∏ —Å —Ä–æ—Ç–∞—Ü–∏–µ–π

–í—Å–µ –∫–∞—Ç–∞–ª–æ–≥–∏ `storage/*` –Ω–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä—É—é—Ç—Å—è (–≤ `.gitignore`).

## –ü—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

- –ú–µ–∂–¥—É —Å–ª–æ—è–º–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä—è–º—ã–µ HTTP –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ—Å–ª–æ–µ–∫
- Extension Hub –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–ª–∞–≥–∏–Ω—ã —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä—É–µ–º—ã–º SDK –∏ —á—ë—Ç–∫–∏–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º
- –í—Å–µ –ø—É—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–Ω–∞–Ω–∏–π –∑–∞—Ç–æ—á–µ–Ω—ã –Ω–∞ –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—é –æ–±—ä—ë–º–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º–æ–≥–æ –≤–æ –≤–Ω–µ—à–Ω–∏–µ LLM
- File-first –ø–æ–¥—Ö–æ–¥: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –Ω–∞–≤—ã–∫–∞–º–∏
